# DatabaseSystems

---

## Задание 4: Знакомство с СУБД RDF. БД - 4store

---

#### История создания и развития СУБД:
База данных 4store была разработана в 2007 году командой ученых из Королевского технологического института в Швеции. Изначально 4store была представлена как проект по исследованию распределенных хранилищ RDF-данных. Затем, благодаря своей высокой производительности и масштабируемости, 4store стала популярным выбором для хранения и обработки RDF-данных в различных приложениях.

Первая версия 4store была выпущена в 2008 году. Впоследствии база данных прошла несколько обновлений, в которых были добавлены новые функциональные возможности и улучшена производительность. В 2011 году 4store стала одной из первых баз данных, которая поддерживала стандарт SPARQL 1.1, что дало ей дополнительный толчок в развитии и увеличило число ее пользователей.

С 2015 года разработка 4store была приостановлена, однако база данных все еще широко используется в различных проектах и остается одним из наиболее популярных инструментов для хранения и обработки RDF-данных. Исходный код 4store до сих пор доступен в открытом доступе на GitHub, а сообщество пользователей продолжает поддерживать базу данных и создавать различные расширения и инструменты для работы с ней.

#### Инструменты для взаимодействия с СУБД
Для взаимодействия с СУБД RDF используются различные инструменты, которые позволяют работать с данными в формате RDF. Некоторые из них:

1. SPARQL (SPARQL Protocol and RDF Query Language) - это язык запросов, разработанный специально для работы с данными RDF. SPARQL позволяет выполнять запросы к СУБД RDF и извлекать информацию в соответствии с заданными критериями.

2. Apache Jena - это набор инструментов и библиотек для работы с данными RDF и выполнения запросов SPARQL. Apache Jena включает в себя инструменты для загрузки, хранения и обработки данных RDF, а также для выполнения запросов SPARQL.

3. RDFLib - это библиотека на языке Python для работы с данными RDF. Она позволяет загружать, создавать, изменять и сохранять данные RDF, а также выполнять запросы SPARQL.

4. Virtuoso - это СУБД, которая поддерживает хранение и обработку данных в формате RDF. Virtuoso также включает в себя инструменты для выполнения запросов SPARQL и интеграцию с другими базами данных.

5. Protege - это инструмент для создания онтологий и работе с данными RDF. Protege позволяет создавать онтологии и загружать данные RDF в них, а также выполнять запросы SPARQL и визуализировать данные в различных форматах.

Это только небольшой список инструментов, которые могут использоваться для работы с данными RDF и выполнения запросов SPARQL. Существует множество других инструментов и библиотек, которые могут быть полезны в работе с данными RDF.

#### Database engine используемый в СУБД

На момент первоначального проектирования было неэкономично приобретать компьютеры с достаточным объемом оперативной памяти для хранения соответствующей доли индекса RDF для прогнозируемого объема данных. Было подсчитано, что разумный средний объем памяти для четырехъядерного устройства составляет около 100 байт, что означает, что для хранения полного индекса потребуется 93 ГБ оперативной памяти. В результате было решено использовать методологию кластерного хранения.

По соображениям экономической эффективности было решено основать кластер на 64-разрядном многоядерном оборудовании x86, работающем под управлением операционной системы Linux. В то время считалось, что это обеспечивает наилучшее соотношение цены и производительности и обеспечивает доступ к большому количеству квалифицированных администраторов и системных программистов. Связь должна была обеспечиваться контроллерами и коммутаторами сетевого интерфейса Gigabit Ethernet.

#### Как устроен язык запросов в вашей СУБД RDF?
Язык запросов для работы с данными RDF называется SPARQL (SPARQL Protocol and RDF Query Language). SPARQL позволяет выполнять запросы к данным RDF и извлекать информацию в соответствии с заданными критериями. Рассмотрим пример выполнения запросов SPARQL к БД 4store с данными.

Шаг 1: Установка БД 4store и загрузка данных

Перед выполнением запросов необходимо установить 4store и загрузить в него данные RDF. Процесс установки и загрузки данных зависит от операционной системы и может отличаться для разных версий 4store. Например, для Ubuntu Linux установка может быть выполнена следующим образом:

```
sudo apt-get install 4store
```

Затем можно загрузить данные RDF в БД с помощью утилиты `4s-import`. Предположим, что данные RDF находятся в файле `data.rdf`. Тогда можно выполнить следующую команду:

```
4s-import default data.rdf
```

Шаг 2: Запросы SPARQL к БД 4store

После загрузки данных можно выполнить запросы SPARQL к БД 4store. Рассмотрим несколько примеров запросов SPARQL:

Пример 1: Выборка всех субъектов, у которых есть свойство `rdf:type` с значением `foaf:Person`

`SPARQL`
```
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>
SELECT ?s
WHERE {
  ?s rdf:type foaf:Person .
}
```

Пример 2: Выборка имен и фамилий всех людей, у которых есть свойство `foaf:knows` с другим человеком

`SPARQL`

```
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>
SELECT ?firstName ?lastName
WHERE {
  ?person rdf:type foaf:Person .
  ?person foaf:knows ?friend .
  ?person foaf:firstName ?firstName .
  ?person foaf:lastName ?lastName .
}
```

Пример 3: Выборка всех субъектов, у которых есть свойство `foaf:name` или `foaf:nick`

`SPARQL`

```
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>
SELECT ?s
WHERE {
  ?s rdf:type foaf:Person .
  ?s foaf:name ?name .
  FILTER(lang(?name) = "en") .
  OPTIONAL {
    ?s foaf:nick ?nick .
    FILTER(lang(?nick) = "en") .
  }
}
```

Шаг 3: Выполнение запросов и просмотр результатов

Для выполнения запросов SPARQL к БД 4store можно воспользоваться командной строкой или интерфейсом веб-браузера.

Для выполнения запросов через командную строку можно воспользоваться утилитой `4s-query`:

```
4s-query default "SELECT ?s WHERE {?s ?p ?o}"
```

Результаты запроса будут выведены в стандартный вывод.

Для выполнения запросов через веб-браузер можно использовать встроенный в 4store веб-интерфейс. Для этого нужно запустить веб-сервер 4store и перейти по адресу `http://localhost:8000/`. В веб-интерфейсе можно вводить SPARQL-запросы в поле "Query" и нажимать кнопку "Submit" для выполнения запроса. Результаты будут отображаться в виде таблицы.

В качестве альтернативы можно использовать специализированные клиенты для работы с данными RDF, такие как RDF4J или Apache Jena.

Важно отметить, что выполнение запросов SPARQL может быть затратным по ресурсам, особенно для больших наборов данных. Поэтому для улучшения производительности может потребоваться оптимизация запросов и использование индексов в БД.

#### Распределение файлов БД
База данных 4store не является распределенной базой данных. Она предназначена для использования на одном компьютере и не поддерживает распределение файлов базы данных по разным носителям.

Однако, в зависимости от конфигурации и ресурсов компьютера, на котором работает 4store, можно рассмотреть возможность разделения файлов базы данных на несколько дисков или разделов для более эффективного использования ресурсов хост-системы. Также можно использовать RAID-массивы для улучшения производительности и надежности хранения данных.

Если требуется распределение данных по разным узлам, то можно рассмотреть использование распределенных баз данных RDF, таких как Virtuoso, Stardog, Blazegraph, GraphDB и других. Эти системы предоставляют механизмы для хранения и обработки данных RDF на нескольких узлах в сети, что позволяет эффективно масштабировать систему и улучшать производительность запросов.

#### На каком языке программирования реализована?

База данных 4store написана на языке программирования Си (C). Исходный код 4store доступен в открытом доступе на GitHub и распространяется под лицензией GNU LGPL (Lesser General Public License).

#### Типы индексов БД 4store

4store поддерживает несколько типов индексов для эффективного хранения и быстрого доступа к данным RDF:

1. Индекс по субъекту (SPO):
   Индекс по субъекту хранит все три компонента триплета (субъект, предикат, объект) и используется для быстрого поиска триплетов по субъекту.

2. Индекс по предикату (POS):
   Индекс по предикату хранит предикат и объект триплета, а также субъекты, связанные с данным предикатом. Используется для быстрого поиска триплетов по предикату.

3. Индекс по объекту (OSP):
   Индекс по объекту хранит объект и субъекты, связанные с данным объектом. Используется для быстрого поиска триплетов по объекту.

4. Индекс по контексту:
   Индекс по контексту хранит информацию о графах, в которых находятся триплеты. Используется для быстрого поиска триплетов в определенных графах.

Пример создания индексов в 4store:

`bash`
```
# Создание индексов по субъекту, предикату и объекту
4s-backend-setup example
4s-backend example
4s-import example file.nt
```

```
# Создание индекса по контексту
4s-backend-setup example_context
4s-backend example_context
4s-import example_context file.nt -c http://example.com/graph
```

В приведенном выше примере создаются две базы данных "example" и "example_context", в которых создаются индексы по субъекту, предикату и объекту, а также индекс по контексту. Затем в базы данных импортируются данные из файла "file.nt". В последней команде импорта указывается опциональный параметр "-c", который позволяет указать граф, к которому относятся импортируемые триплеты. Эта информация используется для создания индекса по контексту.

#### Процесс выполнения запросов

Процесс выполнения запросов в базе данных 4store состоит из нескольких этапов:

1. Синтаксический анализ запроса. 4store использует стандартный язык запросов SPARQL для извлечения данных из хранилища RDF. При поступлении запроса он проходит этап синтаксического анализа, в ходе которого проверяется корректность синтаксиса запроса.

2. Оптимизация запроса. После синтаксического анализа запроса 4store выполняет его оптимизацию. В этом процессе определяются оптимальные способы выполнения запроса, что позволяет снизить нагрузку на хранилище данных и ускорить выполнение запроса.

3. Выполнение запроса. После оптимизации запроса 4store выполняет его в соответствии с выбранным способом выполнения. В процессе выполнения запроса 4store извлекает необходимые данные из хранилища и возвращает результаты запроса.

4. Обработка результатов. После выполнения запроса 4store обрабатывает результаты запроса и возвращает их в виде структурированных данных, например, в формате JSON или XML.

Процесс выполнения запросов в 4store является оптимизированным для работы с RDF-данными. Благодаря этому база данных позволяет быстро и эффективно обрабатывать запросы и извлекать необходимые данные из хранилища.

#### Понятие «план запросов»?

Да, в 4store есть понятие "план запросов" (query plan) - это оптимизированный план выполнения запроса, который 4store строит на основе оптимизации запроса. План запросов позволяет оптимизировать процесс выполнения запроса, ускоряя его выполнение и снижая нагрузку на хранилище данных.

При выполнении запроса 4store строит план выполнения запроса, который определяет порядок выполнения операций извлечения данных из хранилища RDF. Этот план строится с учетом характеристик хранилища данных, размера данных и других факторов.

План запросов можно получить с помощью функции "explain" в 4store. Эта функция позволяет увидеть оптимизированный план выполнения запроса, который используется при выполнении запроса в 4store. Например, чтобы получить план запроса для SPARQL-запроса, можно выполнить следующую команду в командной строке:

```
$ 4s-backend mydb
$ 4s-explain mydb 'SELECT * WHERE {?s ?p ?o}'
```

Эта команда позволит увидеть оптимизированный план выполнения запроса для запроса '"SELECT * WHERE {?s ?p ?o}"'. План запроса будет представлен в виде списка операций, которые будут выполнены для получения результатов запроса.

#### Поддерживаются ли транзакции в 4store?

Да, 4store поддерживает транзакции. Транзакции в 4store обеспечивают целостность данных и защиту от некорректного изменения данных, что особенно важно в многопользовательской среде.

4store поддерживает транзакции на уровне отдельных SPARQL-запросов, а также на уровне изменений в хранилище RDF. Для этого используется механизм блокировки, который предотвращает одновременный доступ к изменяемым данным.

4store также поддерживает механизм отката транзакций, что позволяет отменить все изменения, сделанные в рамках транзакции, в случае возникновения ошибки.

Чтобы использовать транзакции в 4store, необходимо установить параметры блокировки и таймаута транзакции при запуске 4store. Это можно сделать с помощью следующих команд:

```
$ 4s-backend-setup mydb
$ 4s-backend mydb --transactions --timeout=30s
```

Эти команды устанавливают параметры блокировки и таймаута транзакции для базы данных mydb. После этого можно выполнять SPARQL-запросы в рамках транзакций с помощью функции "BEGIN TRANSACTION" и "COMMIT TRANSACTION".

#### Методы восстановления поддерживаемые в 4store

4store поддерживает несколько методов восстановления данных, чтобы обеспечить надежность и целостность хранимых данных:

1. Резервное копирование (backup) - это процесс создания копии всех данных, хранимых в базе данных. В 4store резервное копирование может быть выполнено с помощью команды "4s-backend-dump", которая создает дамп базы данных в формате RDF.

2. Восстановление из резервной копии (restore) - это процесс восстановления данных из резервной копии в случае потери данных или повреждения базы данных. В 4store восстановление может быть выполнено с помощью команды "4s-backend-restore", которая загружает данные из резервной копии в базу данных.

3. Механизм WAL (Write-Ahead Logging) - это механизм, при котором изменения в базе данных записываются в журнал до их фактического применения. Если база данных выходит из строя, то можно использовать журнал для восстановления состояния базы данных до момента сбоя. 4store использует WAL для обеспечения целостности данных.

4. Механизм репликации - это механизм, при котором данные копируются на другие сервера для обеспечения отказоустойчивости и распределения нагрузки. 4store поддерживает репликацию данных с помощью плагина "4s-replicate", который позволяет копировать данные между серверами 4store.

5. Механизм сбора мусора - это процесс удаления устаревших данных из базы данных для освобождения места на диске. В 4store механизм сбора мусора осуществляется автоматически, но можно также выполнить его вручную с помощью команды "4s-backend-vacuum".

#### Типы шардинга

В 4store используется горизонтальный шардинг и вертикальный шардинг.

1. Горизонтальный шардинг (horizontal sharding) - это метод распределения данных по нескольким узлам на основе ключей. В 4store горизонтальный шардинг реализуется путем распределения графов по нескольким узлам, каждый из которых хранит только часть данных. При запросе данных система сначала определяет, на каком узле хранится нужная информация, и затем запрашивает ее у соответствующего узла.

2. Вертикальный шардинг (vertical sharding) - это метод распределения данных по нескольким узлам на основе типов данных. В 4store вертикальный шардинг реализуется путем хранения разных типов данных на разных узлах. Например, субъекты могут храниться на одном узле, а объекты - на другом. Это может улучшить производительность системы, так как при выполнении запросов нужно обращаться только к тем узлам, которые содержат необходимые данные.

Оба типа шардинга позволяют улучшить производительность и масштабируемость системы, распределяя данные по нескольким узлам. При этом каждый узел может работать независимо, что обеспечивает более высокую отказоустойчивость и устойчивость к сбоям.

#### Data Mining, Data Warehousing и OLAP в 4store

Термины Data Mining, Data Warehousing и OLAP (Online Analytical Processing) могут быть применены в контексте работы с данными в 4store, так как эта СУБД может использоваться для хранения, управления и анализа больших объемов структурированных и неструктурированных данных. Рассмотрим каждый термин более подробно:

1. Data Mining (обнаружение закономерностей) - это процесс анализа больших объемов данных с целью выявления скрытых и интересных закономерностей, трендов и паттернов. В 4store можно применять методы Data Mining для анализа графов и отношений между объектами.

2. Data Warehousing (хранение данных) - это процесс сбора, хранения и управления большими объемами данных из различных источников, с целью их последующего анализа. 4store может использоваться как централизованное хранилище данных для Data Warehousing, позволяя быстро и эффективно хранить большие объемы данных.

3. OLAP (Online Analytical Processing) - это технология анализа данных, которая позволяет производить быстрый и гибкий многомерный анализ данных, используя различные способы их агрегации и фильтрации. В 4store можно использовать OLAP-запросы для анализа графов и связей между объектами.

Таким образом, термины Data Mining, Data Warehousing и OLAP могут быть применены в контексте работы с данными в 4store, хотя специфика работы с графовыми данными может отличаться от традиционного подхода к анализу и управлению данными.

#### Защита данных

4store поддерживает несколько методов защиты данных:

1. Аутентификация пользователей - 4store позволяет создавать учетные записи пользователей с разными уровнями доступа к базе данных. Доступ к базе данных может быть ограничен для конкретных пользователей или групп пользователей.

2. Шифрование - 4store поддерживает SSL/TLS для защиты данных во время их передачи между клиентом и сервером.

3. Ограничение доступа к данным - 4store позволяет определять права доступа к различным частям базы данных, что позволяет ограничивать доступ к конфиденциальным данным только тем пользователям, которым это необходимо.

4. Журналирование - 4store ведет журнал всех запросов, выполненных в базе данных, что позволяет отслеживать действия пользователей и выявлять возможные угрозы безопасности.

5. Резервное копирование и восстановление - 4store предоставляет инструменты для создания резервных копий базы данных и восстановления данных в случае сбоя или ошибки.

В целом, 4store обеспечивает надежную защиту данных и предоставляет инструменты для обеспечения безопасности и конфиденциальности данных в базе данных.

#### Развитие 4store

4store - это проект с открытым исходным кодом, развиваемый сообществом разработчиков. Основной репозиторий находится на GitHub, и все желающие могут внести свой вклад в развитие проекта.

4store разрабатывается и поддерживается командой разработчиков из компании Garlik Ltd. Они являются основными разработчиками проекта и имеют права на коммит и создание дистрибутива версий.

Однако, сообщество разработчиков также вносит свой вклад в развитие проекта, исправляет ошибки и добавляет новые функции. Команда разработчиков Garlik Ltd. открыта для общения и сотрудничества с другими участниками проекта и общественности в целом.

#### Самостоятельное изучение

Для продолжения самостоятельного изучения языка запросов в RDF и базы данных 4store можно использовать документацию и руководства по 4store, доступные на официальном сайте проекта (https://github.com/garlik/4store).

Также для изучения языка запросов можно использовать демонстрационные примеры, которые могут быть найдены в Интернете или созданы самостоятельно. Некоторые из таких примеров могут использовать демобазу, которая служит для обучения языку запросов и практики написания запросов.

Одним из примеров такой демобазы является DBpedia, которая представляет собой общедоступную базу знаний в RDF формате, содержащую информацию из Википедии. Для работы с DBpedia необходимо скачать ее файлы и загрузить их в базу данных 4store. Для этого можно использовать инструменты, такие как "rdfloader", "sparql", "s-query" и другие, которые предоставляются в составе 4store.

После загрузки данных в 4store можно выполнять запросы на языке SPARQL для извлечения нужной информации из базы данных. В Интернете можно найти множество примеров запросов на языке SPARQL для работы с DBpedia и другими базами данных RDF.

Также можно создать свою собственную демобазу на основе собранных данных.



